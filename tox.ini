[tox]
requires =
    tox>=4.2
env_list =
    doctest
    type-{313, 312, 311, 310, 39}
    py{313, 312, 311, 310, 39}
skip_missing_interpreters = true

[testenv]
description = run tests using pytest
deps =
    icecream
    pytest
    pytest-sugar
commands =
    pytest .

[testenv:doctest]
description = run doctests
deps =
    icecream
    pytest
    pytest-sugar
commands =
    pytest --doctest-ignore-import-errors --doctest-modules --ignore=python_src/_compat .

[testenv:type-39]
description = run type checks and check stubs
deps =
    codetiming
    icecream
    mypy
    pytest
    pytest-sugar
    typeguard
    types-regex
commands =
    mypy . --exclude='^.*_latest\.py$' \
      --exclude='python_src/_compat/py310' --exclude='python_src/accido/class_adjective.py' \
      --exclude='python_src/accido/class_noun.py' --exclude='python_src/accido/class_verb.py' \
      --exclude='python_src/transfero/adjective_inflection.py' --exclude='python_src/transfero/noun_inflection.py' \
      --exclude='python_src/transfero/verb_inflection.py' --exclude='python_src/transfero/adverb_inflection.py'
    stubtest dill --mypy-config-file mypy.ini --allowlist mypy_stubs/dill/allowlist --ignore-unused-allowlist
    stubtest lemminflect --mypy-config-file mypy.ini --allowlist mypy_stubs/lemminflect/allowlist --ignore-unused-allowlist
    pytest --typeguard-packages=python_src

[testenv:type]
description = run type checks and check stubs
deps =
    codetiming
    icecream
    mypy
    pytest
    pytest-sugar
    typeguard
    types-regex
commands =
    mypy . --exclude='python_src/_compat/py38' --exclude='python_src/_compat/py310'
    stubtest dill --mypy-config-file mypy.ini --allowlist mypy_stubs/dill/allowlist --ignore-unused-allowlist
    stubtest lemminflect --mypy-config-file mypy.ini --allowlist mypy_stubs/lemminflect/allowlist --ignore-unused-allowlist
    pytest --typeguard-packages=python_src

[testenv:type-{312,313}]
description = run type checks and check stubs
deps =
    codetiming
    icecream
    mypy
    pytest
    pytest-sugar
    typeguard
    types-regex
commands =
    mypy . --exclude='python_src/_compat/py38' --exclude='python_src/_compat/py310'
    stubtest dill --mypy-config-file mypy.ini --allowlist mypy_stubs/dill/allowlist --ignore-unused-allowlist
    stubtest lemminflect --mypy-config-file mypy.ini --allowlist mypy_stubs/lemminflect/allowlist --ignore-unused-allowlist
    pytest --typeguard-packages=python_src

[testenv:type-{310,311}]
description = run type checks and check stubs
deps =
    codetiming
    icecream
    mypy
    pytest
    pytest-sugar
    typeguard
    types-regex
commands =
    mypy . --exclude='^.*_latest\.py$' --exclude='python_src/_compat/py38'
    stubtest dill --mypy-config-file mypy.ini --allowlist mypy_stubs/dill/allowlist --ignore-unused-allowlist
    stubtest lemminflect --mypy-config-file mypy.ini --allowlist mypy_stubs/lemminflect/allowlist --ignore-unused-allowlist
    pytest --typeguard-packages=python_src

[gh]
python =
    3.13 = py313, type-313, doctest
    3.12 = py312, type-312
    3.11 = py311, type-311
    3.10 = py310, type-310
    3.9 = py39, type-39
