[tox]
requires =
    tox>=4
env_list = py{38,39,310,311,312,313}, doctest, type-{38,39,310,311,312,313}, coverage
skip_missing_interpreters = True
isolated_build = True

[testenv]
description = run tests using pytest
deps =
    pytest
    pytest-sugar
commands =
    pytest .

[testenv:doctest]
description = run doctests
deps =
    pytest
    pytest-sugar
commands =
    pytest --doctest-ignore-import-errors --doctest-modules --ignore=python_src/_compat .

[testenv:type-{38,39,310,311,312,313}]
description = run type checks and check stubs
deps =
    mypy
commands =
    mypy . --enable-incomplete-feature=NewGenericSyntax
    stubtest dill --mypy-config-file pyproject.toml --allowlist mypy_stubs/dill/allowlist --ignore-unused-allowlist
    stubtest lemminflect --mypy-config-file pyproject.toml --allowlist mypy_stubs/lemminflect/allowlist --ignore-unused-allowlist

[testenv:coverage]
description = run coverage and save to html
deps =
    coverage
    pytest
commands =
    coverage run tests/run_all_tests.py
    coverage html

[gh]
python =
    3.13 = py313, type-313
    3.12 = py312, type-312, doctest
    3.11 = py311, type-311
    3.10 = py310, type-310
    3.9 = py39, type-39
    3.8 = py38, type-38